From 45a3e0c7b75957d2ae9461ebd944ffb5756ff4a9 Mon Sep 17 00:00:00 2001
From: Omar Siam <Omar.Siam@oeaw.ac.at>
Date: Sun, 12 Dec 2021 21:23:07 +0100
Subject: [PATCH 5/5] Prevent Log4Shell CVE-2021-44228 and update jetty patch version

---
 exist-distribution/src/main/config/log4j2.xml | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/exist-distribution/src/main/config/log4j2.xml b/exist-distribution/src/main/config/log4j2.xml
index c415025404..9de625f89d 100644
--- a/exist-distribution/src/main/config/log4j2.xml
+++ b/exist-distribution/src/main/config/log4j2.xml
@@ -5,13 +5,13 @@
         <Property name="rollover.max.size">10MB</Property>
         <Property name="rollover.max">14</Property>
         <Property name="rollover.file.pattern">%d{yyyyMMddHHmmss}</Property>
-        <Property name="exist.file.pattern">%d [%t] %-5p (%F [%M]:%L) - %m %n</Property>
+        <Property name="exist.file.pattern">%d [%t] %-5p (%F [%M]:%L) - %m{noLookups} %n</Property>
     </Properties>
     
     <Appenders>
         
         <Console name="STDOUT">
-            <PatternLayout pattern="%d{DATE} [%t] %-5p (%F [%M]:%L) - %m %n"/>
+            <PatternLayout pattern="%d{DATE} [%t] %-5p (%F [%M]:%L) - %m{noLookups} %n"/>
         </Console>
         
         <RollingRandomAccessFile name="exist.core" filePattern="${logs}/exist.${rollover.file.pattern}.log.gz" fileName="${logs}/exist.log">
@@ -27,7 +27,7 @@
                 <SizeBasedTriggeringPolicy size="${rollover.max.size}"/>
             </Policies>
             <DefaultRolloverStrategy max="${rollover.max}"/>
-            <PatternLayout pattern="%d %-5p - %m %n"/>
+            <PatternLayout pattern="%d %-5p - %m{noLookups} %n"/>
         </RollingRandomAccessFile>
 
         <RollingRandomAccessFile name="exist.ensurelocking" filePattern="${logs}/locks.${rollover.file.pattern}.log.gz" fileName="${logs}/ensure-locking.log">
@@ -35,7 +35,7 @@
                 <SizeBasedTriggeringPolicy size="${rollover.max.size}"/>
             </Policies>
             <DefaultRolloverStrategy max="${rollover.max}"/>
-            <PatternLayout pattern="%d %-5p - %m %n"/>
+            <PatternLayout pattern="%d %-5p - %m{noLookups} %n"/>
         </RollingRandomAccessFile>
 
         <RollingRandomAccessFile name="exist.xmldb" filePattern="${logs}/xmldb.${rollover.file.pattern}.log.gz" fileName="${logs}/xmldb.log">

diff --git "a/exist-parent/pom.xml" "b/exist-parent/pom.xml"
index 2160cf7f0b..da710a1017 100644
--- "a/exist-parent/pom.xml"
+++ "b/exist-parent/pom.xml"
@@ -111,8 +111,8 @@
         <jansi.version>2.4.0</jansi.version>
         <jaxb.api.version>3.0.1</jaxb.api.version>
         <jaxb.impl.version>3.0.2</jaxb.impl.version>
-        <jetty.version>9.4.44.v20210927</jetty.version>
-        <log4j.version>2.17.1</log4j.version>
+        <jetty.version>9.4.50.v20221201</jetty.version>
+        <log4j.version>2.19.0</log4j.version>
         <lucene.version>4.10.4</lucene.version>
         <milton.version>1.8.1.3</milton.version>
         <saxon.version>9.9.1-8</saxon.version>
-- 
2.36.1.windows.1

