From 4d2a5fb561d34cd95fbf4a73c16da497c4492e96 Mon Sep 17 00:00:00 2001
From: Omar Siam <Omar.Siam@oeaw.ac.at>
Date: Sun, 12 Dec 2021 21:23:07 +0100
Subject: [PATCH 5/5] Prevent Log4Shell CVE-2021-44228 and update jetty patch
 version

---
 exist-distribution/src/main/config/log4j2.xml |  8 ++++----
 exist-parent/pom.xml                          | 14 ++++++++++++--
 2 files changed, 16 insertions(+), 6 deletions(-)

diff --git a/exist-distribution/src/main/config/log4j2.xml b/exist-distribution/src/main/config/log4j2.xml
index c415025404..9de625f89d 100644
--- a/exist-distribution/src/main/config/log4j2.xml
+++ b/exist-distribution/src/main/config/log4j2.xml
@@ -5,13 +5,13 @@
         <Property name="rollover.max.size">10MB</Property>
         <Property name="rollover.max">14</Property>
         <Property name="rollover.file.pattern">%d{yyyyMMddHHmmss}</Property>
-        <Property name="exist.file.pattern">%d [%t] %-5p (%F [%M]:%L) - %m %n</Property>
+        <Property name="exist.file.pattern">%d [%t] %-5p (%F [%M]:%L) - %m{noLookups} %n</Property>
     </Properties>
     
     <Appenders>
         
         <Console name="STDOUT">
-            <PatternLayout pattern="%d{DATE} [%t] %-5p (%F [%M]:%L) - %m %n"/>
+            <PatternLayout pattern="%d{DATE} [%t] %-5p (%F [%M]:%L) - %m{noLookups} %n"/>
         </Console>
         
         <RollingRandomAccessFile name="exist.core" filePattern="${logs}/exist.${rollover.file.pattern}.log.gz" fileName="${logs}/exist.log">
@@ -27,7 +27,7 @@
                 <SizeBasedTriggeringPolicy size="${rollover.max.size}"/>
             </Policies>
             <DefaultRolloverStrategy max="${rollover.max}"/>
-            <PatternLayout pattern="%d %-5p - %m %n"/>
+            <PatternLayout pattern="%d %-5p - %m{noLookups} %n"/>
         </RollingRandomAccessFile>
 
         <RollingRandomAccessFile name="exist.ensurelocking" filePattern="${logs}/locks.${rollover.file.pattern}.log.gz" fileName="${logs}/ensure-locking.log">
@@ -35,7 +35,7 @@
                 <SizeBasedTriggeringPolicy size="${rollover.max.size}"/>
             </Policies>
             <DefaultRolloverStrategy max="${rollover.max}"/>
-            <PatternLayout pattern="%d %-5p - %m %n"/>
+            <PatternLayout pattern="%d %-5p - %m{noLookups} %n"/>
         </RollingRandomAccessFile>
 
         <RollingRandomAccessFile name="exist.xmldb" filePattern="${logs}/xmldb.${rollover.file.pattern}.log.gz" fileName="${logs}/xmldb.log">
diff --git a/exist-parent/pom.xml b/exist-parent/pom.xml
index a58799b204..6bc7ef6a98 100644
--- a/exist-parent/pom.xml
+++ b/exist-parent/pom.xml
@@ -112,8 +112,8 @@
         <jansi.version>2.4.0</jansi.version>
         <jaxb.api.version>3.0.1</jaxb.api.version>
         <jaxb.impl.version>3.0.2</jaxb.impl.version>
-        <jetty.version>9.4.50.v20221201</jetty.version>
-        <log4j.version>2.19.0</log4j.version>
+        <jetty.version>9.4.54.v20240208</jetty.version>
+        <log4j.version>2.23.1</log4j.version>
         <lucene.version>4.10.4</lucene.version>
         <milton.version>1.8.1.3</milton.version>
         <saxon.version>9.9.1-8</saxon.version>
@@ -451,6 +451,16 @@
                 <version>1.4.01</version>
             </dependency>
 
+            <!-- forced dependency updates critical patches -->
+
+            <!-- forced dependency updates high patches -->
+
+            <dependency>
+                <groupId>commons-beanutils</groupId>
+                <artifactId>commons-beanutils</artifactId>
+                <version>1.9.4</version>
+            </dependency>
+
             <dependency>
                 <groupId>org.xmlunit</groupId>
                 <artifactId>xmlunit-core</artifactId>
-- 
2.39.2.windows.1

